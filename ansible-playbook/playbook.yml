---
- name: Prepare Servers
  hosts: all
  remote_user: root
  roles:
    - role: common

- name: Install nomad and consul
  hosts: all
  remote_user: root
  roles:
    - role: hashicorp

- name: Configure Nomad clients
  hosts: nomad_clients
  remote_user: root
  tasks:
    - name: Configure client nomad.hcl
      ansible.builtin.import_tasks: roles/hashicorp/tasks/nomad-server.yml
    - name: Validate client consul.hcl
      ansible.builtin.command: nomad config validate /etc/nomad.d/nomad.hcl
      changed_when: false 

- name: Install podman
  hosts: nomad_clients
  remote_user: root
  roles:
    - role: podman
